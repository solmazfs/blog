<!doctype html><html lang=en><head><title>Arch Linux Installation (Legacy) &ndash; blog.solmazfs</title><meta name=description content="I'm working on my blog website."><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin=anonymous><link rel=stylesheet href=https://solmazfs.github.io/blog/css/syntax.css><link rel=stylesheet href=https://solmazfs.github.io/blog/css/colour/cyberpunk.css><link rel=stylesheet href=https://solmazfs.github.io/blog/css/colour/dark-mode.css><link rel=stylesheet href=https://solmazfs.github.io/blog/css/risotto.css><link rel=stylesheet href=https://solmazfs.github.io/blog/css/custom.css></head><body translate=no><div class=page><header class=page__header><h1 class=page__logo><a href=https://solmazfs.github.io/blog class=page__logo-inner>blog.solmazfs</a></h1><nav class="page__nav main-nav"><ul><li class=main-nav__item><a class=nav-main-item href=/blog/posts/ title>Posts</a></li><li class=main-nav__item><a class=nav-main-item href=/blog/categories/ title>Categories</a></li><li class=main-nav__item><a class=nav-main-item href=/blog/now/ title>Now</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>Arch Linux Installation (Legacy)</h1></header><div class=content__body><p>❗ (BIOS type {Legacy})</p><ol><li><a href=#step-1>Make Bootable USB</a></li><li><a href=#step-2>Wipe Disk</a></li><li><a href=#step-3>Disk partitioning –> {legacy}</a></li><li><a href=#step-4>Encryption &ndash;> cryptsetup/luks</a></li><li><a href=#step-5>Formatting&Mounting</a></li><li><a href=#step-6>Downloading {base}</a></li><li><a href=#step-7>TODO</a></li><li><a href=#step-8>Timezone</a></li><li><a href=#step-9>Language</a></li><li><a href=#step-10>root&user setup</a></li><li><a href=#step-11>TODO</a></li><li><a href=#step-12>TODO</a></li><li><a href=#step-13>TODO</a></li><li><a href=#step-14>TODO</a></li><li><a href=#step-15>General setup</a></li><li><a href=#step-16>Install Gnome</a></li><li><a href=#step-17>Optional</a></li></ol><h2 id=step-1>Step 1:</h2><p>(Make bootable USB)</p><ul><li>Download iso &ndash;> !verify</li><li>Use gnome-disk for make bootable USB &ndash;> restore disk image</li><li>Setup bios for booting from USB &ndash;> boot arch-linux</li></ul><h2 id=step-2>Step 2:</h2><p>(Wipe Disk)</p><p>❗ Before this step you may need backup your important files. This process will wipe out all data in your hard drive.</p><ul><li>DEVICE="/dev/sdX"</li><li>PASS=$(tr -cd &lsquo;[:alnum:]&rsquo; &lt; /dev/urandom | head -c128)</li><li>openssl enc -aes-256-ctr -pass pass:"$PASS" -nosalt &lt; /dev/zero | dd obs=64K ibs=4K of=$DEVICE oflag=direct status=progress</li></ul><h2 id=step-3>Step-3:</h2><p>(Disk partitioning &ndash;> {legacy})</p><ul><li><p>cfdisk &ndash;> !label type [dos]</p><ul><li>new &ndash;> !primary</li><li>bootable</li><li>write &ndash;> type &lt; yes ></li><li>quit</li></ul></li><li><p>lsblk # sda, sda1</p></li></ul><h2 id=step-4>Step-4:</h2><p>(Encryption &ndash;> cryptsetup/luks)</p><ul><li>cryptsetup luksFormat &ndash;type luks1 &ndash;use-random -S 1 -s 512 -h sha512 /dev/&lt; sda1 > # type &lt; YES > &ndash;> enter pass</li><li>cryptsetup luksOpen /dev/sda1 &lt; enc-arch ></li></ul><h2 id=step-5>Step-5</h2><p>(physical&logical volume(s))</p><ul><li>pvcreate /dev/mapper/enc-arch</li><li>vgcreate &lt; Arch > /dev/mapper/enc-arch</li><li>lvcreate -L &lt; 3G > Arch -n swap # !for 3gb ram</li><li>lvcreate -L &lt; 32G > Arch -n root # !32|50 gb should be enough</li><li>lvcreate -l 100%FREE Arch -n home</li></ul><h2 id=step-6>Step 6:</h2><p>(Formatting&Mounting)</p><ul><li>mkswap /dev/mapper/Arch-swap</li><li>mkfs.ext4 /dev/mapper/Arch-root</li><li>mkfs.ext4 /dev/mapper/Arch-home</li><li>mount /dev/mapper/Arch-root /mnt</li><li>mkdir /mnt/home</li><li>mount /dev/mapper/Arch-home /mnt/home</li><li>swapon /dev/mapper/Arch-swap</li><li>mkdir /mnt/boot</li></ul><h2 id=step-7>Step 7:</h2><p>(Downloading base)</p><ul><li>pacstrap /mnt base base-devel linux linux-firmware linux-headers mkinitcpio networkmanager wpa_supplicant dialog dhcpcd lvm2 vim terminus-font grub</li></ul><h2 id=step-8>Step 8:</h2><p>(TODO)</p><ul><li>genfstab -U /mnt &#187; /mnt/etc/fstab</li><li>cat /mnt/etc/fstab</li></ul><h2 id=step-9>Step 9:</h2><p>(enter new system chroot)</p><ul><li>arch-chroot /mnt</li></ul><h2 id=step-9-1>Step 9:</h2><p>(Timezone)</p><ul><li>timedatectl set-timezone &ldquo;$(curl -s &ndash;fail <a href=https://ipapi.co/timezone)%22>https://ipapi.co/timezone)"</a></li><li>timedatectl set-ntp true</li><li>hwclock &ndash;systohc &ndash;utc</li></ul><h2 id=step-10>Step 10:</h2><p>(Language)</p><ul><li>echo &lt; dev > > /etc/hostname</li><li>sed -i &lsquo;/en_US.UTF-8 UTF-8/s/^#//g&rsquo; /etc/locale.gen</li><li>echo LANG=en_us.UTF-8 > /etc/locale.conf</li><li>locale-gen</li></ul><h2 id=step-11>Step 11:</h2><p>(root&user setup)</p><ul><li>passwd # root password</li><li>useradd -m -G wheel -s /bin/bash arch-user</li><li>passwd arch-user</li></ul><h2 id=step-12>Step 12:</h2><p>(TODO)</p><ul><li>mkdir /root/.cryptlvm && chmod 700 /root/.cryptlvm</li><li>dd bs=512 count=4 if=/dev/random of=/root/.cryptlvm/archluks.bin iflag=fullblock</li><li>chmod 600 /root/.cryptlvm/archluks.bin</li><li>cryptsetup -v luksAddKey /dev/sda1 /root/.cryptlvm/archluks.bin #enter pass</li><li>cryptsetup luksDump /dev/sda1 #luks key slot 0-1</li></ul><h2 id=step-13>Step 13:</h2><p>(TODO)</p><ul><li>vim /etc/mkinitcpio.conf<ul><li>FILES(/root/.cryptlvm/archluks.bin)</li><li>HOOKS(base udev autodetect modconf block encrypt lvm2 filesystems keyboard fsck)</li></ul></li><li>mkinitcpio -p linux</li></ul><h2 id=step-14>Step 14:</h2><p>(Grub)</p><ul><li><p>UUID=$(blkid /dev/sda1 -s UUID -o value)</p></li><li><p>sed -i &ldquo;/^GRUB_CMDLINE_LINUX=/cGRUB_CMDLINE_LINUX="cryptdevice=UUID=${UUID}:enc-arch root=/dev/mapper/Arch-root cryptkey=rootfs:/root/.cryptlvm/archluks.bin"&rdquo; /etc/default/grub</p></li><li><p>sed -i &ldquo;/GRUB_ENABLE_CRYPTODISK=/cGRUB_ENABLE_CRYPTODISK=y&rdquo; /etc/default/grub</p></li><li><p>grub-install &ndash;target=i386-pc &ndash;bootloader-id=ArchLinux /dev/sda</p></li><li><p>grub-mkconfig -o /boot/grub/grub.cfg</p></li></ul><h2 id=step-15>Step 15:</h2><p>(TODO)</p><ul><li>exit</li><li>umount -R /mnt</li><li>swapoff -a</li><li>reboot #unplug USB</li></ul><hr><h2 id=step-16>Step 16:</h2><p>(General Setup)</p><ul><li>#login as root</li><li>vim /etc/sudoers<ul><li>%wheel NOPASS #uncomment</li></ul></li><li>systemctl start dhcpcd #connect network</li><li>ping github.com #test connection</li><li>pacman -Syu #update system</li><li>pacman -S linux-headers dkms networkmanager?</li><li>pacman -S xorg xorg-apps #(optional?)</li></ul><h2 id=step-17>Step 17:</h2><p>(Install Gnome)</p><ul><li>pacman -S gnome</li><li>systemctl enable gdm #!for user</li></ul><h2 id=step-18>Step 18:</h2><p>(Optional)</p><ul><li>pacman -Rns gnome-software gnome-maps epiphany</li><li>pacman -S chromium</li></ul><hr><p>&(Thanks to <a href=https://gist.github.com/huntrar>@huntrar</a> & <a href=https://gitlab.com/pad92>@pad92</a>)</p><ul><li><a href=https://wiki.archlinux.org/title/Installation_guide>https://wiki.archlinux.org/title/Installation_guide</a></li><li><a href=https://gist.github.com/huntrar/e42aee630bee3295b2c671d098c81268>https://gist.github.com/huntrar/e42aee630bee3295b2c671d098c81268</a></li><li><a href=https://gitlab.com/pad92/dotfiles/-/blob/master/archlinux/install.md>https://gitlab.com/pad92/dotfiles/-/blob/master/archlinux/install.md</a></li></ul></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><img class=about__logo src=https://solmazfs.github.io/blog/images/batFlap.gif alt=Logo><h1 class=about__title>~01/12/2021</h1><p class=about__description>I&rsquo;m working on my blog website.</p></div><ul class=aside__social-links></ul></div><hr><div class=aside__content><p>2021-11-29</p></div></section><footer class=page__footer><p class=copyright>solmazfs © 2021-2022 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>BY-NC-SA 4.0</a></p></footer></div></body></html>